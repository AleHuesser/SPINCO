---
title: "Speech-in-noise comprehension (SPINCO)"
author: "G.Fraga Gonzalez"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: no
runhead: SPINCO
abstract: 'Overview of ongoing projects at Neurolinguistics group (University of Zurich) '
editor_options: 
  markdown: 
    wrap: 72
---

<!-- To unfold code in specific chunks use Chunk options: class.source = 'fold-show' -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gridExtra)
library(dplyr)
library(plotly)
library(ggplot2)
library(nomnoml)
library(kableExtra)
library(DT) # for saving tables
```

<!-- ## Projects {.tabset} -->

## Projects {.tabset} 

### Overview

```{nomnoml flowchart, echo = FALSE, out.height=400,out.width=850}
# https://cran.r-project.org/web/packages/nomnoml/readme/README.html
#fontSize: 6
#arrowSize: .5
#stroke: black
#.box: dashed center
#.comment: fill=Wheat empty bold
#background: FloralWhite
#lineWidth: 1
#direction: right
#leading: 1.25
#lineWidth: .75
#padding: 8
#spacing: 40
#zoom: 3
  
[<database>SPINCO]-> EEG[<comment>SINEEG]
[<database>SPINCO]-> online[<comment>SINON]
  
  [SINON]-->Rmd [database | words | pseudowords] 
  [database]--> Matlab[Manipulations | noise-vocoded | in speech-shaped noise]
  [Manipulations] --> .m[SNR | x 5 Lvls] 
  [SNR | x 5 Levls] -> Gorilla[Tasks | LD | 2FC | pict match]
  
  [<comment>SINEEG]-->Openvibe[Real-time EEG]
  [<comment>SINEEG]-->Matlab[ Manipulation | noise-vocoded]
  [Manipulation] --> .m[SNR. | 3 x Lvls]
  [Real-time EEG] --> [brain-states | alpha | beta-connect?]
  [brain-states] --> [stim trigger]
  [SNR.] -->  [stim trigger]
  [stim trigger] -> psyexp [Task | Lexical Decision]
  

```

### Data workflow

```{nomnoml, echo = FALSE, out.height=400,out.width=850}
# https://cran.r-project.org/web/packages/nomnoml/readme/README.html
#fontSize: 6
#arrowSize: .5
#stroke: black
#.box: dashed center
#.comment: fill=Wheat empty bold
#.client: fill=LavenderBlush empty bold
#background: FloralWhite
#lineWidth: 1
#direction: right
#leading: .75
#lineWidth: .75
#padding: 5
#spacing: 0
#zoom: 2
  
[<state>user]-> local[<comment> PC |]
[PC] --> cloud [<client>OneDrive/Sharepoint | spinco_documentation]
[user]-> remote[<comment>Linux | 130.60.236.20 |130.60.238.20]
[PC] -- [<database> SMB-share ]
 
[<database> SMB-share] <-> private [<client>gfraga | scripts]
  [gfraga | scripts]-:> push2web [<state>github repo]

[<database> SMB-share] <->  [<client>spinco_data |raw, final outputs, long-term ]

[Linux] -- [<database> NFS-share | heavy processing]
[Linux] -- [<database> SMB-share]
[<database> NFS-share] <-> shared [mnt/spinco |intermediate and final outputs]
[<database> NFS-share] <-> private [mnt/gfraga-data]
[<database> NFS-share] <--> shared [spinco_data]
```

<!-- ## Stimuli {.tabset} -->

## Stimuli {.tabset} 

### Recordings

Words and pseudowords were recorded in shuffled order in a single session by
dr. D. Friedrichs (at LIRI, UZH). The session recorded video and .wav files at 48000 Hz; 24 bits.

```{nomnoml , echo = FALSE, out.height=400,out.width=850}
# From  https://nomnoml.com/
#arrowSize: 1
#bendSize: 0.3
#direction:  right 
#gutter: 15
#edgeMargin: 0
#gravity: 1
#edges: hard | rounded
#background: transparent
#fill: #eee8d5; #fdf6e3
#fillArrows: false
#font: Calibri
#fontSize: 12
#leading: 1.25
#lineWidth: 1.5
#padding: 8
#spacing: 45
#stroke: #33322E
#title: filename
#zoom: 1
#acyclicer: greedy
#ranker: network-simplex | tight-tree | longest-path
#.box: fill=#8f8 dashed
#.blob: visual=ellipse title=bold

[<usecase>raw | versions] ->  [<table> Separate files (prorrec) | words | pseudowords]
[<state>normalize] -->  [<state>detectSpeech;(matlab func) |+trim]
[<table> Separate files (prorrec)] --> [<state> normalize]

[detectSpeech;(matlab func) ] --> [<actor>audiocheck|plots]

[<actor>audiocheck] --> if OK  [<abstract>Experiment]
    [<abstract>Experiment]  -->  [<state>clear]
    [<abstract>Experiment] --> [<state>in SSN]
    [<abstract>Experiment] --> [<state>vocoder]
      [<state>vocoder] -- Lvls[<start>st.]
      [<state>in SSN] -- SNRs[<start>st]
[<actor>audiocheck] <--> not OK?[<abstract>audioLabeler* | matlab app; manual trim; select clicks]
      
```
#### **Audio labeler**

Matlab app to apply speech detection in one or more wav files and to
manually adjust the output as a label.

1.   Type: **AudioLabeler** in command line to initialize the app

2.   Go to Label and **load** one or several audio files

3.   **Select all** files and click on Speech detector. This will open a
    new tab with the option to run speech detector. Run it in all files

4.   Now a new **label SpeechDetected** has been created in the ROI
    labels panel.

5.   To **adjust** the label click in one audio file and then in the
    yellow segment marked by the speech detector . If it is not adjust
    the edges of the highlight and then click away in the panel below.
    Make sure the label doesn't reset to the original size!

6.   If you find a '**click**' add a new label called 'click' and select
    a short segment around it. Mark it as 'true' so it is saved.

7.   **Saving** the output. One option is to select all files and then
    click Labels/Export to workspace. This will create a new variable:
    labeledSet_hhmmss (time stamped)

8.   Run **script to use the label info** , transform the click segment
    (if any ) to zero and trim the file.

## SINON {.tabset} 

### Design

```{nomnoml, echo = FALSE, out.height=400,out.width=850}
# https://cran.r-project.org/web/packages/nomnoml/readme/README.html
#fontSize: 6
#arrowSize: .5
#stroke: black
#.box: dashed center
#.comment: fill=lightyellow empty bold
#lineWidth: 1
#direction: right
#leading: 1.25
#lineWidth: .75
#padding: 8
#spacing: 40
#zoom: 2
#direction: down
  
[<database>SINON| manipulations]-> [Within ss]
  [Within ss] --> [Item type | word | pseudo]
  [Within ss] --> ['Noise' type | vocoding | speech-shaped noise]
  [Within ss] --> [SNR | 1 | 2| 3| 4| 5]

[<database>SINON| manipulations]-> [Between ss]
  [Between ss] --> [Task | Lexical decision | 2FC | Pict match]
  

```

```{nomnoml, echo = FALSE, out.height=400,out.width=850}

# https://cran.r-project.org/web/packages/nomnoml/readme/README.html
#fontSize: 6
#arrowSize: .5
#stroke: black
#.box: dashed center
#.comment: fill=lightyellow empty bold
#lineWidth: 1
#direction: right
#leading: 1.25
#lineWidth: .75
#padding: 8
#spacing: 40
#zoom: 2
#direction: right
  
# [<database>SINON Design]-> [<state>LD task]
#  [LD task] --> [NV]
#    [NV] --> [Blocks (4) |||]
#    [Blocks (4)] --> [<table>Trials (2 x 5 x 9 = 80)| Words | Pseudo || .SNR Lv1 | .SNR Lv1 || ... | ... ]
# [LD task] --> [SSN]
#    [SSN] --> [...]
#    [...] --> [....]
# 
# [<database>SINON Design]-> [<state>. Task]
# [<state>. Task] --> [..]
# [..] --> [:..]
# [:..] --> [:...]

#```

### SINEEG

 
```
